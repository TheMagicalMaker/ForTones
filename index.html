<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Chinese Tones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .tone-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .tone-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .tone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--accent-color);
        }

        .tone-card.tone1::before { background: #e74c3c; }
        .tone-card.tone2::before { background: #f39c12; }
        .tone-card.tone3::before { background: #27ae60; }
        .tone-card.tone4::before { background: #3498db; }

        .tone-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .tone1 .tone-number { color: #e74c3c; }
        .tone2 .tone-number { color: #f39c12; }
        .tone3 .tone-number { color: #27ae60; }
        .tone4 .tone-number { color: #3498db; }

        .tone-name {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .tone-description {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .tone-visual {
            height: 80px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .tone-line {
            width: 200px;
            height: 4px;
            background: var(--accent-color);
            position: relative;
            border-radius: 2px;
        }

        .tone1 .tone-line {
            background: #e74c3c;
            transform: none;
        }

        .tone2 .tone-line {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transform: rotate(-30deg);
        }

        .tone3 .tone-line {
            width: 0;
            height: 0;
            border: none;
            position: relative;
        }

        .tone3 .tone-line::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 30px;
            border: 4px solid #27ae60;
            border-top: none;
            border-right: none;
            border-radius: 0 0 0 20px;
            transform: rotate(-35deg) translateX(-20px) translateY(-10px);
        }

        .tone4 .tone-line {
            background: linear-gradient(45deg, #3498db, #2980b9);
            transform: rotate(15deg);
        }

        .example-word {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .chinese-char {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .pinyin {
            font-size: 1.2em;
            color: #7f8c8d;
            margin: 5px 0;
        }

        .meaning {
            font-size: 0.9em;
            color: #95a5a6;
        }

        .quiz-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .quiz-title {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
            color: #2c3e50;
        }

        .quiz-question {
            font-size: 1.3em;
            margin-bottom: 30px;
            text-align: center;
            color: #34495e;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-option {
            padding: 15px 20px;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }

        .quiz-option:hover {
            border-color: #3498db;
            background: #ebf3fd;
        }

        .quiz-option.correct {
            border-color: #27ae60;
            background: #d5f4e6;
            color: #27ae60;
        }

        .quiz-option.incorrect {
            border-color: #e74c3c;
            background: #ffeaea;
            color: #e74c3c;
        }

        .quiz-result {
            text-align: center;
            font-size: 1.2em;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
        }

        .quiz-result.correct {
            background: #d5f4e6;
            color: #27ae60;
        }

        .quiz-result.incorrect {
            background: #ffeaea;
            color: #e74c3c;
        }

        .next-question {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s ease;
        }

        .next-question:hover {
            background: #2980b9;
        }

        .practice-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .tone-practice {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .practice-tone {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #bdc3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #7f8c8d;
        }

        .practice-tone:hover {
            transform: scale(1.1);
        }

        .practice-tone.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .tones-grid {
                grid-template-columns: 1fr;
            }
            
            .tone-card {
                padding: 20px;
            }
            
            .quiz-section, .practice-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ Learn Chinese Tones</h1>
            <p>Master the four fundamental tones of Mandarin Chinese</p>
        </div>

        <div class="tones-grid">
            <div class="tone-card tone1" onclick="playTone(1)">
                <div class="tone-number">1st</div>
                <div class="tone-name">High Level (Èò¥Âπ≥)</div>
                <div class="tone-description">A steady, high pitch that stays constant throughout the syllable.</div>
                <div class="tone-visual">
                    <div class="tone-line"></div>
                </div>
                <div class="example-word">
                    <div class="chinese-char">Â¶à</div>
                    <div class="pinyin">mƒÅ</div>
                    <div class="meaning">mother</div>
                </div>
            </div>

            <div class="tone-card tone2" onclick="playTone(2)">
                <div class="tone-number">2nd</div>
                <div class="tone-name">Rising (Èò≥Âπ≥)</div>
                <div class="tone-description">Starts at a middle pitch and rises to a high pitch, like asking a question.</div>
                <div class="tone-visual">
                    <div class="tone-line"></div>
                </div>
                <div class="example-word">
                    <div class="chinese-char">È∫ª</div>
                    <div class="pinyin">m√°</div>
                    <div class="meaning">hemp, numb</div>
                </div>
            </div>

            <div class="tone-card tone3" onclick="playTone(3)">
                <div class="tone-number">3rd</div>
                <div class="tone-name">Dipping (‰∏äÂ£∞)</div>
                <div class="tone-description">Starts mid, dips low, then rises back up. Like saying "really?" with skepticism.</div>
                <div class="tone-visual">
                    <div class="tone-line"></div>
                </div>
                <div class="example-word">
                    <div class="chinese-char">È©¨</div>
                    <div class="pinyin">m«é</div>
                    <div class="meaning">horse</div>
                </div>
            </div>

            <div class="tone-card tone4" onclick="playTone(4)">
                <div class="tone-number">4th</div>
                <div class="tone-name">Falling (ÂéªÂ£∞)</div>
                <div class="tone-description">Starts high and drops sharply to a low pitch, like a firm command.</div>
                <div class="tone-visual">
                    <div class="tone-line"></div>
                </div>
                <div class="example-word">
                    <div class="chinese-char">È™Ç</div>
                    <div class="pinyin">m√†</div>
                    <div class="meaning">to scold</div>
                </div>
            </div>
        </div>

        <div class="quiz-section">
            <h2 class="quiz-title">üß† Tone Recognition Quiz</h2>
            <div id="quiz-content">
                <div class="quiz-question" id="quiz-question">
                    Which tone does this character use: <strong id="quiz-char">Â¶à</strong> (mother)?
                </div>
                <div class="quiz-options" id="quiz-options">
                    <div class="quiz-option" onclick="selectAnswer(1)">1st Tone (High Level)</div>
                    <div class="quiz-option" onclick="selectAnswer(2)">2nd Tone (Rising)</div>
                    <div class="quiz-option" onclick="selectAnswer(3)">3rd Tone (Dipping)</div>
                    <div class="quiz-option" onclick="selectAnswer(4)">4th Tone (Falling)</div>
                </div>
                <div id="quiz-result" class="quiz-result" style="display: none;"></div>
                <button id="next-question" class="next-question" onclick="nextQuestion()" style="display: none;">Next Question</button>
            </div>
        </div>

        <div class="practice-section">
            <h2>üéØ Tone Practice</h2>
            <p>Click on a tone number to hear how it sounds, then practice speaking!</p>
            <div class="tone-practice">
                <div class="practice-tone" onclick="playTone(1)">1</div>
                <div class="practice-tone" onclick="playTone(2)">2</div>
                <div class="practice-tone" onclick="playTone(3)">3</div>
                <div class="practice-tone" onclick="playTone(4)">4</div>
            </div>
            <p><em>Click each tone to hear an example sound pattern</em></p>
        </div>
    </div>

    <script>
        // Quiz data
        const quizData = [
            { char: 'Â¶à', pinyin: 'mƒÅ', meaning: 'mother', tone: 1 },
            { char: 'È∫ª', pinyin: 'm√°', meaning: 'hemp', tone: 2 },
            { char: 'È©¨', pinyin: 'm«é', meaning: 'horse', tone: 3 },
            { char: 'È™Ç', pinyin: 'm√†', meaning: 'to scold', tone: 4 },
            { char: '‰ªñ', pinyin: 'tƒÅ', meaning: 'he/him', tone: 1 },
            { char: 'Ëå∂', pinyin: 'ch√°', meaning: 'tea', tone: 2 },
            { char: 'Êâì', pinyin: 'd«é', meaning: 'to hit', tone: 3 },
            { char: 'Â§ß', pinyin: 'd√†', meaning: 'big', tone: 4 }
        ];

        let currentQuestion = 0;
        let score = 0;
        let answered = false;

        // Audio context for tone generation
        let audioContext;
        let isAudioInitialized = false;

        function initAudio() {
            if (!isAudioInitialized) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                isAudioInitialized = true;
            }
        }

        function playTone(toneNumber) {
            initAudio();
            
            // Add visual feedback
            const toneCard = document.querySelector(`.tone${toneNumber}`);
            if (toneCard) {
                toneCard.classList.add('playing');
                setTimeout(() => toneCard.classList.remove('playing'), 500);
            }

            // Create oscillator for tone
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Set volume
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            const startTime = audioContext.currentTime;
            const duration = 1.0;
            
            // Define tone patterns
            switch(toneNumber) {
                case 1: // High level tone
                    oscillator.frequency.setValueAtTime(330, startTime); // E4
                    break;
                case 2: // Rising tone
                    oscillator.frequency.setValueAtTime(220, startTime); // A3
                    oscillator.frequency.exponentialRampToValueAtTime(330, startTime + duration); // to E4
                    break;
                case 3: // Dipping tone
                    oscillator.frequency.setValueAtTime(260, startTime); // C4
                    oscillator.frequency.exponentialRampToValueAtTime(196, startTime + duration/2); // to G3
                    oscillator.frequency.exponentialRampToValueAtTime(294, startTime + duration); // to D4
                    break;
                case 4: // Falling tone
                    oscillator.frequency.setValueAtTime(330, startTime); // E4
                    oscillator.frequency.exponentialRampToValueAtTime(165, startTime + duration); // to E3
                    break;
            }
            
            oscillator.start(startTime);
            oscillator.stop(startTime + duration);
        }

        function loadQuestion() {
            const question = quizData[currentQuestion];
            document.getElementById('quiz-char').textContent = question.char;
            document.getElementById('quiz-question').innerHTML = 
                `Which tone does this character use: <strong>${question.char}</strong> (${question.meaning})?`;
            
            // Reset options
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.className = 'quiz-option';
            });
            
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('next-question').style.display = 'none';
            answered = false;
        }

        function selectAnswer(selectedTone) {
            if (answered) return;
            
            answered = true;
            const question = quizData[currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            const resultDiv = document.getElementById('quiz-result');
            
            options.forEach((option, index) => {
                const toneNum = index + 1;
                if (toneNum === question.tone) {
                    option.classList.add('correct');
                } else if (toneNum === selectedTone && selectedTone !== question.tone) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedTone === question.tone) {
                score++;
                resultDiv.textContent = `Correct! üéâ "${question.char}" (${question.pinyin}) is ${question.tone}${getOrdinalSuffix(question.tone)} tone.`;
                resultDiv.className = 'quiz-result correct';
            } else {
                resultDiv.textContent = `Not quite. "${question.char}" (${question.pinyin}) is ${question.tone}${getOrdinalSuffix(question.tone)} tone, not ${selectedTone}${getOrdinalSuffix(selectedTone)} tone.`;
                resultDiv.className = 'quiz-result incorrect';
            }
            
            resultDiv.style.display = 'block';
            document.getElementById('next-question').style.display = 'inline-block';
        }

        function getOrdinalSuffix(num) {
            const suffixes = ['', 'st', 'nd', 'rd', 'th'];
            return suffixes[num] || 'th';
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion >= quizData.length) {
                // Quiz completed
                document.getElementById('quiz-content').innerHTML = `
                    <div style="text-align: center;">
                        <h3>Quiz Complete! üéä</h3>
                        <p style="font-size: 1.2em; margin: 20px 0;">
                            You scored ${score} out of ${quizData.length}
                        </p>
                        <button class="next-question" onclick="resetQuiz()">Start Over</button>
                    </div>
                `;
            } else {
                loadQuestion();
            }
        }

        function resetQuiz() {
            currentQuestion = 0;
            score = 0;
            document.getElementById('quiz-content').innerHTML = `
                <div class="quiz-question" id="quiz-question">
                    Which tone does this character use: <strong id="quiz-char">Â¶à</strong> (mother)?
                </div>
                <div class="quiz-options" id="quiz-options">
                    <div class="quiz-option" onclick="selectAnswer(1)">1st Tone (High Level)</div>
                    <div class="quiz-option" onclick="selectAnswer(2)">2nd Tone (Rising)</div>
                    <div class="quiz-option" onclick="selectAnswer(3)">3rd Tone (Dipping)</div>
                    <div class="quiz-option" onclick="selectAnswer(4)">4th Tone (Falling)</div>
                </div>
                <div id="quiz-result" class="quiz-result" style="display: none;"></div>
                <button id="next-question" class="next-question" onclick="nextQuestion()" style="display: none;">Next Question</button>
            `;
            loadQuestion();
        }

        // Initialize the quiz
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestion();
            initializeWaveBars();
            updatePracticeWord();
        });

        // Practice tone highlighting
        document.querySelectorAll('.practice-tone').forEach(tone => {
            tone.addEventListener('click', function() {
                document.querySelectorAll('.practice-tone').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                setTimeout(() => this.classList.remove('active'), 1000);
            });
        });

        // Recording functionality
        async function toggleRecording() {
            if (!isRecording) {
                await startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                recordedChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                    recordedAudio = URL.createObjectURL(blob);
                    document.getElementById('play-btn').disabled = false;
                    showFeedback();
                };
                
                mediaRecorder.start();
                isRecording = true;
                
                // Update UI
                const recordBtn = document.getElementById('record-btn');
                recordBtn.textContent = '‚èπÔ∏è Stop Recording';
                recordBtn.className = 'record-btn stop';
                
                document.getElementById('recording-status').textContent = 'Recording... Speak now!';
                document.getElementById('recording-status').className = 'recording-status recording';
                
                startWaveAnimation();
                
            } catch (error) {
                console.error('Error accessing microphone:', error);
                document.getElementById('recording-status').textContent = 'Error: Could not access microphone';
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                
                // Update UI
                const recordBtn = document.getElementById('record-btn');
                recordBtn.textContent = 'üé§ Start Recording';
                recordBtn.className = 'record-btn start';
                
                document.getElementById('recording-status').textContent = 'Recording complete! Click play to listen.';
                document.getElementById('recording-status').className = 'recording-status';
                
                stopWaveAnimation();
            }
        }

        function playRecording() {
            if (recordedAudio) {
                const audio = new Audio(recordedAudio);
                audio.play();
                
                document.getElementById('recording-status').textContent = 'Playing back your recording...';
                
                audio.onended = () => {
                    document.getElementById('recording-status').textContent = 'Playback complete. How did you do?';
                };
            }
        }

        function nextPracticeWord() {
            currentPracticeWord = (currentPracticeWord + 1) % quizData.length;
            updatePracticeWord();
            resetRecording();
        }

        function updatePracticeWord() {
            try {
                const word = quizData[currentPracticeWord];
                if (!word) return;
                
                // Check if elements exist before updating
                const charEl = document.getElementById('practice-char');
                const pinyinEl = document.getElementById('practice-pinyin');
                const meaningEl = document.getElementById('practice-meaning');
                const toneInfoEl = document.getElementById('practice-tone-info');
                
                if (charEl && word.char) charEl.textContent = word.char;
                if (pinyinEl && word.pinyin) pinyinEl.textContent = word.pinyin;
                if (meaningEl && word.meaning) meaningEl.textContent = word.meaning;
                
                if (toneInfoEl && word.tone) {
                    const toneNames = ['', 'High Level', 'Rising', 'Dipping', 'Falling'];
                    const toneName = toneNames[word.tone] || 'Unknown';
                    const suffix = getOrdinalSuffix(word.tone);
                    toneInfoEl.textContent = `${word.tone}${suffix} tone (${toneName})`;
                }
            } catch (error) {
                console.error('Error updating practice word:', error);
            }
        }

        function resetRecording() {
            if (isRecording) {
                stopRecording();
            }
            
            recordedAudio = null;
            document.getElementById('play-btn').disabled = true;
            document.getElementById('recording-status').textContent = 'Ready to record - Press the microphone button to start';
            document.getElementById('feedback').className = 'feedback-section';
        }

        function showFeedback() {
            const feedback = document.getElementById('feedback');
            const encouragements = [
                'Great job! Keep practicing to master the tones.',
                'Nice work! Try to match the pitch pattern even more closely.',
                'Good effort! Remember to start and end at the right pitch levels.',
                'Well done! Practice makes perfect with Chinese tones.',
                'Excellent! Your pronunciation is improving.'
            ];
            
            feedback.innerHTML = `<strong>Recording Complete!</strong> ${encouragements[Math.floor(Math.random() * encouragements.length)]}`;
            feedback.className = 'feedback-section good show';
            
            setTimeout(() => {
                feedback.className = 'feedback-section';
            }, 5000);
        }

        // Wave animation functions
        function initializeWaveBars() {
            const waveBars = document.getElementById('wave-bars');
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.height = '10px';
                waveBars.appendChild(bar);
            }
        }

        function startWaveAnimation() {
            const bars = document.querySelectorAll('.wave-bar');
            const animateWave = () => {
                if (isRecording) {
                    bars.forEach((bar, index) => {
                        const height = Math.random() * 40 + 10;
                        bar.style.height = height + 'px';
                    });
                    setTimeout(animateWave, 100);
                }
            };
            animateWave();
        }

        function stopWaveAnimation() {
            const bars = document.querySelectorAll('.wave-bar');
            bars.forEach(bar => {
                bar.style.height = '10px';
            });
        }
    </script>
</body>
</html>
